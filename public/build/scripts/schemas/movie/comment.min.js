var mongoose=require("mongoose"),Schema=mongoose.Schema,ObjectId=Schema.Types.ObjectId,CommentSchema=new Schema({movie:{type:ObjectId,ref:"Movie"},from:{type:ObjectId,ref:"User"},reply:[{from:{type:ObjectId,ref:"User"},to:{type:ObjectId,ref:"User"},content:String,meta:{createAt:{type:Date,"default":Date.now()}}}],content:String,meta:{createAt:{type:Date,"default":Date.now()},updateAt:{type:Date,"default":Date.now()}}});CommentSchema.pre("save",function(e){this.isNew?this.meta.createAt=this.meta.updateAt=Date.now():this.meta.updateAt=Date.now(),e()}),CommentSchema.statics={fetch:function(e){return this.find({}).sort("meta.updateAt").exec(e)},findById:function(e,t){return this.findOne({_id:e}).exec(t)}},module.exports=CommentSchema;