var mongoose=require("mongoose"),bcrypt=require("bcrypt"),SALT_WORK_FACTOR=10,UserSchema=new mongoose.Schema({name:{unique:!0,type:String},password:String,role:{type:Number,"default":0},meta:{createAt:{type:Date,"default":Date.now()},updateAt:{type:Date,"default":Date.now()}}});UserSchema.pre("save",function(e){var t=this;this.isNew?this.meta.createAt=this.meta.updateAt=Date.now():this.meta.updateAt=Date.now(),bcrypt.genSalt(SALT_WORK_FACTOR,function(r,a){return r?e(r):void bcrypt.hash(t.password,a,function(r,a){return r?e(r):(t.password=a,void e())})})}),UserSchema.methods={comparePassword:function(e,t){bcrypt.compare(e,this.password,function(e,r){return e?t(e):void t(null,r)})}},UserSchema.statics={fetch:function(e){return this.find({}).sort("meta.updateAt").exec(e)},findById:function(e,t){return this.findOne({_id:e}).exec(t)}},module.exports=UserSchema;