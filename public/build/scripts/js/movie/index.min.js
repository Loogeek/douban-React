$(function(){(function(){function e(t){var e=(d-1)*o;$("#screenBody").is(":animated")||("right"===t?a===d?(a=1,$("#m-screenTop .ui-side-index").html(a),$("#screenBody").animate({left:0},700)):(a++,$("#m-screenTop .ui-side-index").html(a),$("#screenBody").animate({left:"-="+o},700)):1===a?(a=d,$("#m-screenTop .ui-side-index").html(a),$("#screenBody").animate({left:"-="+e},700)):(a--,$("#m-screenTop .ui-side-index").html(a),$("#screenBody").animate({left:"+="+o},700)))}var i=$("#headerNow span"),n=$("#m-screenTop .panel"),a=1,s=$("#m-screenTop .glyphicon-chevron-right"),l=$("#m-screenTop .glyphicon-chevron-left"),o=n.width(),r=$("#m-screenTop .thumbnail"),c=r.length,d=Math.ceil(c/4);$("#m-screenTop .ui-side-max").html(d),$("#screenBody").width(o*d),i.on("click",function(){var e=$(this).text(),s="/?galleryName="+encodeURIComponent(e);t(s,"GET",function(t){var s=t.data||[],l=s.movies,m=s.movies.length;if($("#headerNow a").attr("href","/results?cat="+s._id+"&p=0").text(s.name),"即将上映"===e?i.text("正在上映"):i.text("即将上映"),m<r.length){$("#m-screenTop .thumbnail:gt("+m+")").remove();for(var h=0;m>h;h++){$(r[h]).find("a").attr("href",l[h]._id),$(r[h]).find("h5").html(l[h].title);var p=$(r[h]).find("img");l[h].poster.indexOf("http:")>-1?p.attr("src",l[h].poster).attr("alt",l[h].poster):p.attr("src","/upload/"+l[h].poster).attr("alt",l[h].poster)}}else{for(var f=0;f<r.length;f++){$(r[f]).find("a").attr("href",l[f]._id),$(r[f]).find("h5").html(l[f].title);var u=$(r[f]).find("img");l[f].poster.indexOf("http:")>-1?u.attr("src",l[f].poster).attr("alt",l[f].poster):u.attr("src","/upload/"+l[f].poster).attr("alt",l[f].poster)}for(var g=r.length;m>g;g++)$("#screenBody").append('<div class="thumbnail"><a href="/movie/'+l[g]._id+'"></a><div class="caption"><h5>'+l[g].title+"</h5></div></div>"),l[g].poster.indexOf("http:")>-1?$("#screenBody .thumbnail:eq("+g+") a").append("<img src="+l[g].poster+" alt="+l[g].title+">"):$("#screenBody .thumbnail:eq("+g+") a").append("<img src=/upload/"+s[g].poster+" alt="+s[g].title+">")}o=n.width(),r=$("#m-screenTop .thumbnail"),c=r.length,d=Math.ceil(c/4),a>d&&(a=d,$("#m-screenTop .ui-side-index").html(a),$("#screenBody").animate({left:-o*(a-1)},0)),$("#m-screenTop .ui-side-max").html(d),$("#screenBody").width(o*d)})}),s.on("click",function(){e("right")}),l.on("click",function(){e("left")});var m=setInterval(function(){e("right")},5e3);$("#m-screenTop").on("mouseover",function(){clearInterval(m)}).on("mouseout",function(){m=setInterval(function(){e("right")},5e3)})})();$("#classTop").on("click","button",function(){if(!$(this).is(".btn-primary")){var e=$(this).html(),i="/?className="+encodeURIComponent(e+"电影");t(i,"GET",function(t){var e=t.data.movies,i=$("#classBody .thumbnail"),n=e.length-1;if(e.length<=i.length){$("#screenClass .col-md-3:gt("+n+")").remove();for(var a=0;a<e.length;a++){$(i[a]).find("a").attr("href",e[a]._id),$(i[a]).find("h5").html(e[a].title);var s=$(i[a]).find("img");e[a].poster.indexOf("http:")>-1?s.attr("src",e[a].poster).attr("alt",e[a].poster):s.attr("src","/upload/"+e[a].poster).attr("alt",e[a].poster)}}else{for(var l=0;l<i.length;l++){$(i[l]).find("a").attr("href",e[l]._id),$(i[l]).find("h5").html(e[l].title);var o=$(i[l]).find("img");e[l].poster.indexOf("http:")>-1?o.attr("src",e[l].poster).attr("alt",e[l].poster):o.attr("src","/upload/"+e[l].poster).attr("alt",e[l].poster)}for(var r=i.length;r<e.length;r++)$("#classBody").append('<div class="col-md-3"><div class="thumbnail"><a href="/movie/'+e[r]._id+'"></a><div class="caption"><h5>'+e[r].title+"</h5></div></div></div>"),e[r].poster.indexOf("http:")>-1?$("#classBody .thumbnail:eq("+r+") a").append("<img src="+e[r].poster+" alt="+e[r].title+">"):$("#classBody .thumbnail:eq("+r+") a").append("<img src=/upload/"+e[r].poster+" alt="+e[r].title+">")}}),$(this).addClass("btn-primary").removeClass("btn-default").siblings("button").addClass("btn-default").removeClass("btn-primary")}});var t=(function(){var t=1,e=$("#m-galleryFrames .glyphicon-chevron-right"),i=$("#m-galleryFrames .glyphicon-chevron-left"),n=$("#m-galleryFrames li").length,a=$("#m-galleryFrames ul"),s=$("#m-galleryFrames li").width();$("#m-galleryFrames .ui-side-max").html(n-2),e.on("click",function(){o("right")}),i.on("click",function(){o("left")});var l=setInterval(function(){o("right")},5e3);$("#m-galleryFrames").on("mouseover",function(){clearTimeout(l)}).on("mouseout",function(){l=setInterval(function(){o("right")},5e3)});var o=function(e){a.is(":animated")||("right"===e?(t++,$("#m-galleryFrames .ui-side-index").html(t),a.animate({left:"-="+s},700),t===n-1&&(t=1,$("#m-galleryFrames .ui-side-index").html(t),a.animate({left:"-605px"},0))):(t--,$("#m-galleryFrames .ui-side-index").html(t),a.animate({left:"+="+s},700),0===t&&(t=n-2,$("#m-galleryFrames .ui-side-index").html(t),a.animate({left:"-2312px"},0))))}}(),function(){var e=$("#citiesList"),i=$("#citySug .city-suggestion-list"),n=$("#citySug .auto-tip"),a=$("#citySug input");$("#cityId").on("click",function(){"none"===e.css("display")?e.css("display","block"):e.css("display","none")}),$(".cities-list-hd").on("click","span",function(){var t=$(this).attr("index");$(this).addClass("on").siblings().removeClass("on"),$("#citiesList").find(".cities-list-item").eq(t-1).addClass("active").siblings().removeClass("active")}),$("#citiesList .cities-list-item").on("click","a",function(){$("#cityId").html($(this).html()),$("#citiesList").css("display","none"),a.val("")}),a.on("focus",function(){var e,s=$("#cityId").html(),l=$(this).val();n.html(""),a.val()?(e="/?suggest="+encodeURIComponent(s)+"&&search="+encodeURIComponent(l),t(e,"GET",function(t){for(var e=t||[],a=0;a<e.length;a++)n.append('<li><a href="javascript:;">'+e[a]+"</a></li>");i.css("display","block")})):(e="/?suggest="+encodeURIComponent(s),t(e,"GET",function(t){if(t.data){for(var e=t.data.name,a=0;a<e.length;a++)n.append('<li><a href="javascript:;">'+e[a]+"</a></li>");i.css("display","block")}})),a.on("keyup",function(a){s=$("#cityId").html(),l=$(this).val(),e="/?suggest="+encodeURIComponent(s)+"&&search="+encodeURIComponent(l),(49<a.keyCode&&a.keyCode<57||32===a.keyCode)&&t(e,"GET",function(t){var e=t||[];n.html("");for(var a=0;a<e.length;a++)n.append('<li><a href="javascript:;">'+e[a]+"</a></li>");i.css("display","block")})}),$("#citiesList").css("display","none")}),i.on("mousedown","a",function(){a.val($(this).html()),i.css("display","none")}),a.on("blur",function(){$("#citySug .city-suggestion-list").css("display","none")})}(),function(t,e,i){$.ajax({url:t,cache:!0,type:e,crossDomain:!0}).done(i)})});