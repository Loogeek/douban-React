var CommentMovie=require("../../models/movie/comment");exports.save=function(e,o){var n=e.body.comment;n.movie;if(n.cid)CommentMovie.findById(n.cid,function(e,t){var i={from:n.from,to:n.tid,content:n.content,meta:{createAt:Date.now()}};t.reply.push(i),t.save(function(e,n){e&&console.log(e),CommentMovie.findOne({_id:n._id}).populate("from","name").populate("reply.from reply.to","name").exec(function(e,n){o.json({data:n})})})});else{var t=new CommentMovie(n);t.save(function(e,n){e&&console.log(e),CommentMovie.findOne({_id:n._id}).populate("from","name").populate("reply.from reply.to","name").exec(function(e,n){o.json({data:n})})})}},exports.del=function(e,o){var n=e.query.cid,t=e.query.did;"undefined"!==t?CommentMovie.findOne({_id:n},function(e,n){for(var i=n.reply.length,m=0;i>m;m++)n.reply[m]&&n.reply[m]._id.toString()===t&&n.reply.splice(m,1);n.save(function(e,o){e&&console.log(e)}),o.json({success:1})}):CommentMovie.remove({_id:n},function(e,n){e&&console.log(e),o.json({success:1})})};