var User=require("../../models/user/user");exports.signup=function(e,n){var s=e.body.user;User.findOne({name:s.name},function(o,r){return o&&console.log(o),r?n.json({data:0}):(r=new User(s),void r.save(function(s,o){return s&&console.log(s),e.session.user=o,n.json({data:1})}))})},exports.showSignup=function(e,n){n.render("user/signup",{title:"注册页面"})},exports.signin=function(e,n){var s=e.body.user||"",o=s.name||"",r=s.password;User.findOne({name:o},function(s,o){return s&&console.log(s),o?void o.comparePassword(r,function(s,r){return s&&console.log(s),r?(e.session.user=o,n.json({data:2})):n.json({data:1})}):(console.log("用户不存在"),n.json({data:0}))})},exports.showSignin=function(e,n){n.render("user/signin",{title:"登录页面"})},exports.logout=function(e,n){delete e.session.user,n.redirect("/")},exports.list=function(e,n){User.fetch(function(e,s){e&&console.log(e),n.render("user/userlist",{title:"豆瓣电影用户列表页",users:s})})},exports.signinRequired=function(e,n,s){var o=e.session.user;o||n.redirect("/signin"),s()},exports.adminRequired=function(e,n,s){var o=e.session.user;o.role<=10&&n.redirect("/signin"),s()},exports.del=function(e,n){var s=e.query.id;s&&User.remove({_id:s},function(e,s){e&&console.log(e),n.json({success:1})})};