var MusicCategory=require("../../models/music/musicCategory"),Programme=require("../../models/music/programme"),underscore=require("underscore");exports["new"]=function(e,i){Programme.find({},function(e,r){i.render("music/musicCategoryAdmin",{title:"豆瓣音乐后台分类录入页",programmes:r,musicCategory:{}})})},exports.save=function(e,i){var r=(e.body.musicCategory._id,e.body.musicCategory),o=r.programmeId,s=r.programmeName,n=new MusicCategory(r);n.save(function(e,r){if(e&&console.log(e),o)Programme.findById(o,function(e,o){o.musicCategories.push(r._id),o.save(function(e,r){i.redirect("/admin/music/programme/list")})});else if(s){var n=new Programme({name:s,musicCategories:[r._id]});n.save(function(e,o){r.programme=o._id,r.save(function(e,r){i.redirect("/admin/music/programme/list")})})}})},exports.list=function(e,i){MusicCategory.find({}).populate({path:"musics",select:"title image singer version summary pv"}).exec(function(e,r){e&&console.log(e),i.render("music/musicCategorylist",{title:"豆瓣音乐分类列表页",musicCategories:r})})},exports.del=function(e,i){var r=e.query.id;r&&MusicCategory.remove({_id:r},function(e,r){e&&console.log(e),i.json({success:1})})},exports.detail=function(e,i){var r=e.params.id;MusicCategory.update({_id:r},{$inc:{pv:1}},function(e){e&&console.log(e)})},exports.update=function(e,i){var r=e.params.id;MusicCategory.findById(r,function(e,r){MusicCategory.find({},function(e,o){e&&console.log(e),i.render("music/admin",{title:"豆瓣音乐后台更新页",music:r,musicCategories:o})})})};