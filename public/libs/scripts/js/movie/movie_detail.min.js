"use strict";$.support.cors=!0,$(function(){function a(a){return 10>a?"0"+a:""+a}function b(b){return a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())}var c=15*Math.ceil($(".rating-num strong").html()-10);$(".star").css("background-position-y",c),$("#mediaList").on("click",".comment",function(){var a=$(this),b=a.data("tid"),c=a.data("cid");$(a).parents(".media-body").attr("id","mediaBody"),$("#toId").length>0?$("#toId").val(b):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:b}).appendTo("#commentForm"),$("#commentId").length>0?$("#commentId").val(c):$("<input>").attr({type:"hidden",id:"commentId",name:"comment[cid]",value:c}).appendTo("#commentForm")}),$("#comments button").on("click",function(a){a.preventDefault(),$.ajax({url:"/admin/movie/movieComment",type:"POST",data:{"comment[movie]":$('#comments input[name="comment[movie]"]').val(),"comment[from]":$('#comments input[name="comment[from]"]').val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(a){var c=a.data||{};if(c.reply.length){var d=c.reply.length;$("#mediaBody").append('<div class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;"/></div><div class="media-body"><h4  class="media-heading">'+c.reply[d-1].from.name+"<span>&nbsp;回复&nbsp;</span>"+c.reply[d-1].to.name+"</h4><p>"+c.reply[d-1].content+'</p><span class="createAt">'+b(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+c._id+" data-tid="+c.reply[d-1].to._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+c._id+" data-did="+c.reply[d-1]._id+">删除</a></div></div>")}else $("#mediaList").append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+c.from.name+"</h4><p>"+c.content+'</p><span class="createAt">'+b(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+c._id+" data-tid="+c.from._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+c._id+">删除</a></div><hr></li>");$("#comments textarea").val(""),$("#mediaBody").removeAttr("id"),$("#commentForm input:gt(1)").remove()})}),$("#mediaList").on("click",".comment-del",function(a){var b=$(this).parent(".media-body"),c=$(a.target).data("cid"),d=$(a.target).data("did");$.ajax({url:"/movie/:id?cid="+c+"&did="+d,type:"DELETE"}).done(function(a){1===a.success&&b.parent().remove()})})});