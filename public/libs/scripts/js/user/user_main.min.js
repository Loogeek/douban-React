"use strict";$.support.cors=!0,$(function(){function a(){$.ajax({url:"/captcha",type:"GET"}).done(function(a){$(".captcha-show").text(a)})}var b=!0,c={signIn:function(a){$(a).validate({rules:{name:{required:!0,minlength:2,maxlength:15},password:{required:!0,minlength:2,maxlength:15},captcha:{required:!0}},messages:{name:{required:"必须填写用户名",minlength:"用户名最小2位",maxlength:"用户名最大15位"},password:{required:"必须填写密码",minlength:"密码最小2位",maxlength:"密码最大15位"},captcha:{required:"必须填写验证码"}},submitHandler:function(){$.ajax({url:"/user/signin",method:"GET",data:{user:$(a).serialize()}}).done(function(b){switch(b.data){case 0:$(a).find("input:eq(0)").val().length>1&&$(a).find(".error:eq(0)").html("用户不存在").show(),$(a).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true");break;case 1:$(a).find("input:eq(1)").val().length>1&&$(a).find(".error:eq(1)").html("密码填写错误").show(),$(a).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true");break;case 2:""!==$(a).find("input:eq(2)")&&$(a).find(".error:eq(2)").html("验证码填写错误").show(),$(a).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true");break;default:$("a")[0].click()}})},invalidHandler:function(){b=!1,$(a).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true")}})},signUp:function(a){$(a).validate({rules:{name:{required:!0,minlength:2,maxlength:15},password:{required:!0,minlength:2,maxlength:15},"confirm-password":{equalTo:$(a).find("input:eq(1)")},captcha:{required:!0}},messages:{name:{required:"必须填写用户名",minlength:"用户名最小2位",maxlength:"用户名最大15位"},password:{required:"必须填写密码",minlength:"密码最小2位",maxlength:"密码最大15位"},"confirm-password":{equalTo:"两次输入的密码不相同"},captcha:{required:"必须填写验证码"}},submitHandler:function(){$.ajax({url:"/user/signup",method:"POST",data:{user:$(a).serialize()}}).done(function(b){switch(console.log(b),b.data){case 0:$(a).find("input:eq(0)").val().length>1&&$(a).find(".error:eq(0)").html("用户已存在").show(),$(a).find('button:contains("注册")').addClass("btn-danger").attr("disabled","true");break;case 1:""!==$(a).find("input:eq(3)")&&(console.log($(a).find("input:eq(3)")),$(a).find(".error:eq(3)").html("验证码填写错误").show()),$(a).find('button:contains("注册")').addClass("btn-danger").attr("disabled","true");break;default:$("a")[0].click()}})},invalidHandler:function(){b=!1,$(a).find('button:contains("注册")').addClass("btn-danger").attr("disabled","true")}})}};c.signIn("#signinForm"),c.signIn("#dSigninForm"),c.signUp("#signupForm"),c.signUp("#dSignupForm"),$(".form-clear").on("click",function(){$(this).parent().find("input").val("").trigger("keypress")}),$(".modal-body input").on("keypress",function(){""===$(this).val()?$(this).parent().find("span").addClass("has-remove-sign"):$(this).parent().find("span").removeClass("has-remove-sign"),$(".modal-footer").find('button:contains("登录")').removeClass("btn-danger").removeAttr("disabled"),$(".modal-footer").find('button:contains("注册")').removeClass("btn-danger").removeAttr("disabled")}).trigger("keypress"),$(".captcha-repeat,.captcha-show").on("click",function(){a()}),a()});