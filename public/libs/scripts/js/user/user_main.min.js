"use strict";$.support.cors=!0,$(function(){function n(){$.ajax({url:"/captcha",type:"GET"}).done(function(n){$(".captcha-show").text(n)})}var e=!0,a={signIn:function(n){$(n).validate({rules:{name:{required:!0,minlength:2,maxlength:15},password:{required:!0,minlength:2,maxlength:15},captcha:{required:!0}},messages:{name:{required:"必须填写用户名",minlength:"用户名最小2位",maxlength:"用户名最大15位"},password:{required:"必须填写密码",minlength:"密码最小2位",maxlength:"密码最大15位"},captcha:{required:"必须填写验证码"}},submitHandler:function(){$.ajax({url:"/user/signin",method:"GET",data:{user:$(n).serialize()}}).done(function(e){switch(e.data){case 0:$(n).find("input:eq(0)").val().length>1&&$(n).find(".error:eq(0)").html("用户不存在").show(),$(n).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true");break;case 1:$(n).find("input:eq(1)").val().length>1&&$(n).find(".error:eq(1)").html("密码填写错误").show(),$(n).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true");break;case 2:""!==$(n).find("input:eq(2)")&&$(n).find(".error:eq(2)").html("验证码填写错误").show(),$(n).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true");break;default:$("a")[0].click()}})},invalidHandler:function(){e=!1,$(n).find('button:contains("登录")').addClass("btn-danger").attr("disabled","true")}})},signUp:function(n){$(n).validate({rules:{name:{required:!0,minlength:2,maxlength:15},password:{required:!0,minlength:2,maxlength:15},"confirm-password":{equalTo:$(n).find("input:eq(1)")},captcha:{required:!0}},messages:{name:{required:"必须填写用户名",minlength:"用户名最小2位",maxlength:"用户名最大15位"},password:{required:"必须填写密码",minlength:"密码最小2位",maxlength:"密码最大15位"},"confirm-password":{equalTo:"两次输入的密码不相同"},captcha:{required:"必须填写验证码"}},submitHandler:function(){$.ajax({url:"/user/signup",method:"POST",data:{user:$(n).serialize()}}).done(function(e){switch(console.log(e),e.data){case 0:$(n).find("input:eq(0)").val().length>1&&$(n).find(".error:eq(0)").html("用户已存在").show(),$(n).find('button:contains("注册")').addClass("btn-danger").attr("disabled","true");break;case 1:""!==$(n).find("input:eq(3)")&&(console.log($(n).find("input:eq(3)")),$(n).find(".error:eq(3)").html("验证码填写错误").show()),$(n).find('button:contains("注册")').addClass("btn-danger").attr("disabled","true");break;default:$("a")[0].click()}})},invalidHandler:function(){e=!1,$(n).find('button:contains("注册")').addClass("btn-danger").attr("disabled","true")}})}};a.signIn("#signinForm"),a.signIn("#dSigninForm"),a.signUp("#signupForm"),a.signUp("#dSignupForm"),$(".form-clear").on("click",function(){$(this).parent().find("input").val("").trigger("keypress")}),$(".modal-body input").on("keypress",function(){""===$(this).val()?$(this).parent().find("span").addClass("has-remove-sign"):$(this).parent().find("span").removeClass("has-remove-sign"),$(".modal-footer").find('button:contains("登录")').removeClass("btn-danger").removeAttr("disabled"),$(".modal-footer").find('button:contains("注册")').removeClass("btn-danger").removeAttr("disabled")}).trigger("keypress"),$(".captcha-repeat,.captcha-show").on("click",function(){n()}),n()});